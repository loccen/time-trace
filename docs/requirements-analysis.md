# 时迹（TimeTrace）需求分析文档

## 1. 项目概述

### 1.1 项目名称
- 中文名：时迹
- 英文名：TimeTrace

### 1.2 项目目标
开发一个本地离线使用的个人工时记录软件，通过自动监听系统事件来记录用户的工作时间，并提供友好的Web界面进行数据管理和分析。

### 1.3 核心价值
- **自动化**：无需手动打卡，自动记录工时
- **离线化**：完全本地运行，数据安全可控
- **智能化**：自动处理异常情况，智能补齐缺失数据
- **可视化**：提供直观的数据展示和分析功能

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 自动工时记录
**功能描述**：自动监听系统事件，记录上下班时间

**详细需求**：
- **上班打卡触发条件**：
  - 用户第一次解锁电脑
  - 开机启动
  - 用户登录系统
- **下班打卡触发条件**：
  - 锁定桌面
  - 关机
  - 注销登录
  - 系统休眠

**特殊情况处理**：
- 异常关机检测：如果当天没有下班打卡记录，标记为异常
- 自动补齐：下次上班时，自动补齐前一天的下班时间
- 重复事件过滤：短时间内的重复锁定/解锁事件应被过滤

#### 2.1.2 数据存储
**功能描述**：本地SQLite数据库存储所有工时数据

**数据模型**：
- 工时记录表（time_records）
  - id：主键
  - date：日期
  - clock_in：上班时间
  - clock_out：下班时间
  - duration：工作时长（分钟）
  - status：状态（正常/异常/手动修改）
  - created_at：创建时间
  - updated_at：更新时间

#### 2.1.3 后台静默运行
**功能描述**：程序在后台无界面运行，不干扰用户正常工作

**技术要求**：
- 无控制台窗口
- 最小化系统资源占用
- 稳定的事件监听
- 异常自动恢复

### 2.2 用户界面功能

#### 2.2.1 数据展示
- **工时列表**：按日期显示工时记录
- **统计概览**：今日、本周、本月工时统计
- **趋势分析**：工时变化趋势图表

#### 2.2.2 数据管理
- **手动编辑**：修改已有工时记录
- **手动添加**：添加新的工时记录
- **数据删除**：删除错误记录
- **批量操作**：批量修改或删除记录

#### 2.2.3 数据分析
- **时间统计**：按日/周/月统计工时
- **趋势图表**：工时变化趋势可视化
- **工作模式分析**：分析工作时间规律

#### 2.2.4 数据导出
- **CSV导出**：导出工时数据为CSV格式
- **日期范围选择**：支持指定时间范围导出
- **格式自定义**：支持自定义导出字段

### 2.3 系统功能

#### 2.3.1 配置管理
- **基本设置**：工作时间设置、提醒设置
- **高级设置**：数据库路径、日志级别
- **导入导出**：配置文件的导入导出

#### 2.3.2 日志记录
- **操作日志**：记录用户操作
- **系统日志**：记录系统事件和错误
- **性能日志**：记录性能指标

## 3. 非功能需求

### 3.1 性能需求
- **启动时间**：程序启动时间不超过3秒
- **响应时间**：Web界面响应时间不超过1秒
- **资源占用**：内存占用不超过50MB，CPU占用率低于1%

### 3.2 可靠性需求
- **数据完整性**：确保工时数据不丢失
- **异常恢复**：程序异常退出后能自动恢复
- **事件监听稳定性**：7x24小时稳定监听系统事件

### 3.3 兼容性需求
- **操作系统**：支持Windows 10/11，macOS 10.15+，Ubuntu 18.04+
- **浏览器**：支持Chrome、Firefox、Safari、Edge最新版本
- **Python版本**：支持Python 3.8+

### 3.4 安全需求
- **数据安全**：本地数据加密存储
- **隐私保护**：不收集用户隐私信息
- **访问控制**：Web界面仅本地访问

### 3.5 可维护性需求
- **代码质量**：代码覆盖率不低于80%
- **文档完整性**：提供完整的开发和用户文档
- **模块化设计**：采用模块化架构，便于维护和扩展

## 4. 约束条件

### 4.1 技术约束
- 必须使用Python作为后端开发语言
- 必须使用Vue 3作为前端框架
- 必须使用SQLite作为数据库
- 必须支持离线运行

### 4.2 部署约束
- 必须能打包成单个可执行文件
- 必须支持开机自启动
- 必须能在无网络环境下运行

### 4.3 用户约束
- 用户需要有基本的计算机操作能力
- 用户需要授权程序监听系统事件
- 用户需要保持程序持续运行以确保数据记录

## 5. 验收标准

### 5.1 功能验收
- [ ] 能够自动记录上下班时间
- [ ] 能够处理异常情况并自动补齐数据
- [ ] Web界面能够正常显示和操作数据
- [ ] 数据导出功能正常工作
- [ ] 程序能够稳定后台运行

### 5.2 性能验收
- [ ] 程序启动时间符合要求
- [ ] Web界面响应时间符合要求
- [ ] 系统资源占用符合要求

### 5.3 兼容性验收
- [ ] 在目标操作系统上正常运行
- [ ] 在目标浏览器中正常显示
- [ ] 打包后的程序能够独立运行

## 6. 风险分析

### 6.1 技术风险
- **系统事件监听**：不同操作系统的事件监听机制差异较大
- **权限问题**：某些系统可能需要特殊权限才能监听事件
- **兼容性问题**：不同版本操作系统的API差异

### 6.2 用户体验风险
- **误触发**：频繁的锁定/解锁可能导致错误记录
- **数据丢失**：程序异常可能导致数据丢失
- **性能影响**：后台程序可能影响系统性能

### 6.3 缓解措施
- 充分测试不同操作系统和版本
- 实现完善的异常处理和数据备份机制
- 优化程序性能，最小化系统资源占用
- 提供详细的用户文档和故障排除指南
